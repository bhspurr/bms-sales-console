<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Build My Story — Sales Console</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar blue">
    <div class="brand">
      <div class="blob"></div>
      <h1>Build My Story — Sales Console</h1>
    </div>
    <nav class="tabs">
      <button class="tab active" data-tab="consoleTab">Console</button>
      <button class="tab" data-tab="summaryTab">Deals Summary</button>
    </nav>
    <div class="actions">
      <input id="dealIdInput" type="text" placeholder="Enter Deal ID or Email" />
      <button id="loadBtn">Load</button>
      <button id="refreshBtn" class="ghost">Refresh</button>
      <span id="lastSync" class="muted small"></span>
      <a id="telLink" class="callbtn" href="#" target="_self">Call</a>
    </div>
  </header>

  <div class="layout">
    <aside class="sidebar">
      <div class="side-section">
        <div class="side-header">
          <h3>Browse Deals</h3>
        </div>

        <label class="label">Month</label>
        <select id="monthSelect" class="select">
          <option value="">All months</option>
        </select>

        <label class="label">Filters</label>
        <div class="filters-grid">
          <label><input type="checkbox" id="f_startFilled" /> Start date filled</label>
          <label><input type="checkbox" id="f_phone" /> Phone number available</label>
          <label><input type="checkbox" id="f_formFilled" /> Form filled = Yes</label>
          <label><input type="checkbox" id="f_signedUp" /> Signed up = Yes</label>
        </div>

        <input id="dealSearch" class="search" type="text" placeholder="Search deals..." />
        <div id="dealList" class="deal-list"></div>
        <div class="pager">
          <button id="prevPage" class="ghost">Prev</button>
          <span id="pageInfo" class="muted small"></span>
          <button id="nextPage" class="ghost">Next</button>
        </div>
      </div>
    </aside>

    <main class="main">
      <div id="consoleTab" class="tabview active">
        <div class="grid">
          <section class="card">
            <h2>Lead Overview</h2>
            <div id="leadOverview" class="kv"></div>
            <details class="all-fields">
              <summary>All Fields</summary>
              <div id="allFields" class="kv kv2"></div>
            </details>
          </section>

          <section class="card">
            <h2>Suggested Call Windows</h2>
            <div id="callWindows"></div>
            <div class="inline-actions">
              <div class="prefix">
                <span>Activity Prefix:</span>
                <label><input type="radio" name="prefix" value="BS" checked /> BS</label>
                <label><input type="radio" name="prefix" value="JS" /> JS</label>
              </div>
              <button id="scheduleLunch">Schedule Lunch Call</button>
              <button id="scheduleAfter">Schedule After-school Call</button>
            </div>
          </section>

          <section class="card wide">
            <h2>Call Script</h2>
            <div class="script-controls">
              <label>Role
                <select id="roleSelect">
                  <option>Teacher — No Start Date</option>
                  <option>Teacher — Start Date</option>
                  <option>Teacher — Universal</option>
                  <option>Principal — Online Meet</option>
                </select>
              </label>
              <label>Grade
                <select id="gradeSelect"></select>
              </label>
            </div>
            <div class="script-grid">
              <div class="form-col">
                <div id="scriptForm"></div>
                <div class="inline-actions">
                  <button id="summarizeBtn">Summarize Notes</button>
                  <button id="sendSummaryBtn" class="ghost">Send Summary to Pipedrive</button>
                </div>
              </div>
              <div class="summary-col">
                <h3>Live Summary</h3>
                <div id="summaryBox" class="summary"></div>
              </div>
            </div>
          </section>

          <section class="card">
            <h2>Notes & Disposition</h2>
            <textarea id="notes" placeholder="Type notes from the call here..."></textarea>
            <div class="inline-actions">
              <select id="disposition">
                <option value="Contacted">Contacted</option>
                <option value="Left VM">Left VM</option>
                <option value="No Answer">No Answer</option>
                <option value="Interested">Interested</option>
                <option value="Not Interested">Not Interested</option>
                <option value="Follow-up Needed">Follow-up Needed</option>
              </select>
              <button id="saveNote">Save Note & Activity</button>
            </div>
            <div id="saveResult" class="muted"></div>
          </section>

          <section class="card wide">
            <h2>Contacted Today</h2>
            <div id="contactedToday"></div>
            <div class="inline-actions">
              <button id="exportTodayCsv" class="ghost">Export CSV</button>
            </div>
          </section>
        </div>

        <div class="nav-nextprev">
          <button id="prevDeal" class="round ghost">◀ Back</button>
          <button id="nextDeal" class="round">Next ▶</button>
        </div>
      </div>

      <div id="summaryTab" class="tabview">
        <section class="card wide">
          <h2>Deals Summary</h2>
          <div class="inline-actions">
            <label><input type="checkbox" id="sum_phone" /> Phone present</label>
            <label><input type="checkbox" id="sum_past" /> Start date in past</label>
            <label><input type="checkbox" id="sum_future" /> Start date in future</label>
            <button id="exportDealsCsv" class="ghost">Export CSV</button>
          </div>
          <div id="summaryTableWrap" class="tablewrap"></div>
        </section>
      </div>
    </main>
  </div>

  <footer class="footer">
    <div>Tip: paste a Deal ID or an email, then hit <b>Load</b>. Set your token and start date field in <code>config.json</code>.</div>
  </footer>

  <script src="./scripts/call_scripts_v3.js"></script>
  <script src="./app_v3.js"></script>
</body>
</html>